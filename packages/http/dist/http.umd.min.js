/** @license @lljj/http (c) 2020-2020 Liu.Jun License: MIT */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).http={})}(this,(function(e){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t,n,r,o,a,i){try{var u=e[a](i),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,o)}function r(e){return function(){var t=this,r=arguments;return new Promise((function(o,a){var i=e.apply(t,r);function u(e){n(i,o,a,u,c,"next",e)}function c(e){n(i,o,a,u,c,"throw",e)}u(void 0)}))}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){u(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,o=!1,a=void 0;try{for(var i,u=e[Symbol.iterator]();!(r=(i=u.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){o=!0,a=e}finally{try{r||null==u.return||u.return()}finally{if(o)throw a}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return f(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return f(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function p(e,t){this.promise=e instanceof Promise?e:new Promise(e.bind(t)),this.context=t}p.all=function(e,t){return new p(Promise.all(e),t)},p.resolve=function(e,t){return new p(Promise.resolve(e),t)},p.reject=function(e,t){return new p(Promise.reject(e),t)},p.race=function(e,t){return new p(Promise.race(e),t)};var h=p.prototype;h.bind=function(e){return this.context=e,this},h.then=function(e,t){return e&&e.bind&&this.context&&(e=e.bind(this.context)),t&&t.bind&&this.context&&(t=t.bind(this.context)),new p(this.promise.then(e,t),this.context)},h.catch=function(e){return e&&e.bind&&this.context&&(e=e.bind(this.context)),new p(this.promise.catch(e),this.context)},h.finally=function(e){return this.then((function(t){return e.call(this),t}),(function(t){return e.call(this),Promise.reject(t)}))};var d={}.hasOwnProperty,m=[].slice,y="undefined"!=typeof window;function v(e){return e?e.replace(/^\s*|\s*$/g,""):""}function b(e){return e?e.toLowerCase():""}var g=Array.isArray;function w(e){return"string"==typeof e}function j(e){return"function"==typeof e}function O(e){return null!==e&&"object"===t(e)}function x(e){return O(e)&&Object.getPrototypeOf(e)===Object.prototype}function T(e,t,n){var r=p.resolve(e);return arguments.length<2?r:r.then(t,n)}function k(e,t){var n,r;if(g(e))for(n=0;n<e.length;n++)t.call(e[n],e[n],n);else if(O(e))for(r in e)d.call(e,r)&&t.call(e[r],e[r],r);return e}var C=Object.assign||function(e){var t=m.call(arguments,1);return t.forEach((function(t){P(e,t)})),e};function P(e,t,n){for(var r in t)n&&(x(t[r])||g(t[r]))?(x(t[r])&&!x(e[r])&&(e[r]={}),g(t[r])&&!g(e[r])&&(e[r]=[]),P(e[r],t[r],n)):void 0!==t[r]&&(e[r]=t[r])}function E(e,t,n){var r=function(e){var t=["+","#",".","/",";","?","&"],n=[];return{vars:n,expand:function(r){return e.replace(/\{([^{}]+)\}|([^{}]+)/g,(function(e,o,a){if(o){var i=null,u=[];if(-1!==t.indexOf(o.charAt(0))&&(i=o.charAt(0),o=o.substr(1)),o.split(/,/g).forEach((function(e){var t=/([^:*]*)(?::(\d+)|(\*))?/.exec(e);u.push.apply(u,function(e,t,n,r){var o=e[n],a=[];if(S(o)&&""!==o)if("string"==typeof o||"number"==typeof o||"boolean"==typeof o)o=o.toString(),r&&"*"!==r&&(o=o.substring(0,parseInt(r,10))),a.push(R(t,o,A(t)?n:null));else if("*"===r)Array.isArray(o)?o.filter(S).forEach((function(e){a.push(R(t,e,A(t)?n:null))})):Object.keys(o).forEach((function(e){S(o[e])&&a.push(R(t,o[e],e))}));else{var i=[];Array.isArray(o)?o.filter(S).forEach((function(e){i.push(R(t,e))})):Object.keys(o).forEach((function(e){S(o[e])&&(i.push(encodeURIComponent(e)),i.push(R(t,o[e].toString())))})),A(t)?a.push(encodeURIComponent(n)+"="+i.join(",")):0!==i.length&&a.push(i.join(","))}else";"===t?a.push(encodeURIComponent(n)):""!==o||"&"!==t&&"?"!==t?""===o&&a.push(""):a.push(encodeURIComponent(n)+"=");return a}(r,i,t[1],t[2]||t[3])),n.push(t[1])})),i&&"+"!==i){var c=",";return"?"===i?c="&":"#"!==i&&(c=i),(0!==u.length?i:"")+u.join(c)}return u.join(",")}return L(a)}))}}}(e),o=r.expand(t);return n&&n.push.apply(n,r.vars),o}function S(e){return null!=e}function A(e){return";"===e||"&"===e||"?"===e}function R(e,t,n){return t="+"===e||"#"===e?L(t):encodeURIComponent(t),n?encodeURIComponent(n)+"="+t:t}function L(e){return e.split(/(%[0-9A-Fa-f]{2})/g).map((function(e){return/%[0-9A-Fa-f]/.test(e)||(e=encodeURI(e)),e})).join("")}function $(e,t){var n,r=this||{},o=e;return w(e)&&(o={url:e,params:t}),o=function(e){var t=m.call(arguments,1);return t.forEach((function(t){P(e,t,!0)})),e}({},$.options,r.$options,o),$.transforms.forEach((function(e){w(e)&&(e=$.transform[e]),j(e)&&(n=function(e,t,n){return function(r){return e.call(n,r,t)}}(e,n,r.$vm))})),n(o)}function U(e){return new p((function(t){var n=new XDomainRequest,r=function(r){var o=r.type,a=0;"load"===o?a=200:"error"===o&&(a=500),t(e.respondWith(n.responseText,{status:a}))};e.abort=function(){return n.abort()},n.open(e.method,e.getUrl()),e.timeout&&(n.timeout=e.timeout),n.onload=r,n.onabort=r,n.onerror=r,n.ontimeout=r,n.onprogress=function(){},n.send(e.getBody())}))}$.options={url:"",root:null,params:{}},$.transform={template:function(e){var t=[],n=E(e.url,e.params,t);return t.forEach((function(t){delete e.params[t]})),n},query:function(e,t){var n=Object.keys($.options.params),r={},o=t(e);return k(e.params,(function(e,t){-1===n.indexOf(t)&&(r[t]=e)})),(r=$.params(r))&&(o+=(-1==o.indexOf("?")?"?":"&")+r),o},root:function(e,t){var n,r,o=t(e);return w(e.root)&&!/^(https?:)?\//.test(o)&&(o="".concat((n=e.root,r="/",n&&void 0===r?n.replace(/\s+$/,""):n&&r?n.replace(new RegExp("[".concat(r,"]+$")),""):n),"/").concat(o)),o}},$.transforms=["template","query","root"],$.params=function(e){var t=[],n=encodeURIComponent;return t.add=function(e,t){j(t)&&(t=t()),null===t&&(t=""),this.push("".concat(n(e),"=").concat(n(t)))},function e(t,n,r){var o,a=g(n),i=x(n);k(n,(function(n,u){o=O(n)||g(n),r&&(u="".concat(r,"[").concat(i||o?u:"","]")),!r&&a?t.add(n.name,n.value):o?e(t,n,u):t.add(u,n)}))}(t,e),t.join("&").replace(/%20/g,"+")},$.parse=function(e){var t=document.createElement("a");return document.documentMode&&(t.href=e,e=t.href),t.href=e,{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",port:t.port,host:t.host,hostname:t.hostname,pathname:"/"===t.pathname.charAt(0)?t.pathname:"/".concat(t.pathname),search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):""}};var I=y&&"withCredentials"in new XMLHttpRequest;function _(e){return new p((function(t){var n,r,o=e.jsonp||"callback",a=e.jsonpCallback||"_jsonp".concat(Math.random().toString(36).substr(2)),i=null;n=function(n){var o=n.type,u=0;"load"===o&&null!==i?u=200:"error"===o&&(u=500),u&&window[a]&&(delete window[a],document.body.removeChild(r)),t(e.respondWith(i,{status:u}))},window[a]=function(e){i=JSON.stringify(e)},e.abort=function(){n({type:"abort"})},e.params[o]=a,e.timeout&&setTimeout(e.abort,e.timeout),(r=document.createElement("script")).src=e.getUrl(),r.type="text/javascript",r.async=!0,r.onload=n,r.onerror=n,document.body.appendChild(r)}))}function N(e){return new p((function(t){var n=new XMLHttpRequest,r=function(r){var o=e.respondWith("response"in n?n.response:n.responseText,{status:1223===n.status?204:n.status,statusText:1223===n.status?"No Content":v(n.statusText)});k(v(n.getAllResponseHeaders()).split("\n"),(function(e){o.headers.append(e.slice(0,e.indexOf(":")),e.slice(e.indexOf(":")+1))})),t(o)};e.abort=function(){return n.abort()},n.open(e.method,e.getUrl(),!0),e.timeout&&(n.timeout=e.timeout),e.responseType&&"responseType"in n&&(n.responseType=e.responseType),(e.withCredentials||e.credentials)&&(n.withCredentials=!0),e.crossOrigin||e.headers.set("X-Requested-With","XMLHttpRequest"),j(e.progress)&&"GET"===e.method&&n.addEventListener("progress",e.progress),j(e.downloadProgress)&&n.addEventListener("progress",e.downloadProgress),j(e.progress)&&/^(POST|PUT)$/i.test(e.method)&&n.upload.addEventListener("progress",e.progress),j(e.uploadProgress)&&n.upload&&n.upload.addEventListener("progress",e.uploadProgress),e.headers.forEach((function(e,t){n.setRequestHeader(t,e)})),n.onload=r,n.onabort=r,n.onerror=r,n.ontimeout=r,n.send(e.getBody())}))}function D(e){e.cancelToken&&e.cancelToken.promise.then((function(){e.abort()})),j(e.sendAfter)&&e.sendAfter.call(this,e)}function M(e){var t=(e.client||N)(e);return function(e){D.call(null,e)}(e),t}var H=function(){function e(t){var n=this;o(this,e),this.map={},k(t,(function(e,t){return n.append(t,e)}))}return i(e,[{key:"has",value:function(e){return null!==J(this.map,e)}},{key:"get",value:function(e){var t=this.map[J(this.map,e)];return t?t.join():null}},{key:"getAll",value:function(e){return this.map[J(this.map,e)]||[]}},{key:"set",value:function(e,t){this.map[function(e){if(/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return v(e)}(J(this.map,e)||e)]=[v(t)]}},{key:"append",value:function(e,t){var n=this.map[J(this.map,e)];n?n.push(v(t)):this.set(e,t)}},{key:"delete",value:function(e){delete this.map[J(this.map,e)]}},{key:"deleteAll",value:function(){this.map={}}},{key:"forEach",value:function(e,t){var n=this;k(this.map,(function(r,o){k(r,(function(r){return e.call(t,r,o,n)}))}))}}]),e}();function J(e,t){return Object.keys(e).reduce((function(e,n){return b(t)===b(n)?n:e}),null)}var q=function(){function e(t,n){var r,a=n.url,i=n.headers,u=n.status,c=n.statusText;o(this,e),this.url=a,this.ok=u>=200&&u<300,this.status=u||0,this.statusText=c||"",this.headers=new H(i),this.body=t,w(t)?this.bodyText=t:(r=t,"undefined"!=typeof Blob&&r instanceof Blob&&(this.bodyBlob=t,function(e){return 0===e.type.indexOf("text")||-1!==e.type.indexOf("json")}(t)&&(this.bodyText=function(e){return new p((function(t){var n=new FileReader;n.readAsText(e),n.onload=function(){t(n.result)}}))}(t))))}return i(e,[{key:"blob",value:function(){return T(this.bodyBlob)}},{key:"text",value:function(){return T(this.bodyText)}},{key:"json",value:function(){return T(this.text(),(function(e){return JSON.parse(e)}))}}]),e}();Object.defineProperty(q.prototype,"data",{get:function(){return this.body},set:function(e){this.body=e}});var B=function(){function e(t){var n;o(this,e),this.body=null,this.params={},C(this,t,{method:(n=t.method||"GET",n?n.toUpperCase():"")}),this.headers instanceof H||(this.headers=new H(this.headers))}return i(e,[{key:"getUrl",value:function(){return $(this)}},{key:"getBody",value:function(){return this.body}},{key:"respondWith",value:function(e,t){return new q(e,C(t||{},{url:this.getUrl()}))}}]),e}(),X=function(){function e(t){var n,r=this;if(o(this,e),"function"!=typeof t)throw new TypeError("executor must be a function.");this.promise=new Promise((function(e){n=e})),t((function(){r.reason||n()}))}return i(e,null,[{key:"source",value:function(){var t;return{token:new e((function(e){t=e})),cancel:t}}}]),e}(),F={"Content-Type":"application/json;charset=utf-8"};function W(e){var n=this||{},r=function(e){var n=[M],r=[];function o(o){for(;n.length;){var a=n.pop();if(j(a)){var i=function(){var t=void 0,n=void 0;if(O(t=a.call(e,o,(function(e){return n=e}))||n))return{v:new p((function(n,o){r.forEach((function(n){t=T(t,(function(t){return n.call(e,t)||t}),o)})),T(t,n,o)}),e)};j(t)&&r.unshift(t)}();if("object"===t(i))return i.v}else"Invalid interceptor of type ".concat(t(a),", must be a function")}}return O(e)||(e=null),o.use=function(e){n.push(e)},o}(n.$vm);return function(e){var t=m.call(arguments,1);t.forEach((function(t){for(var n in t)void 0===e[n]&&(e[n]=t[n])}))}(e||{},n.$options,W.options),W.interceptors.forEach((function(e){w(e)&&(e=W.interceptor[e]),j(e)&&r.use(e)})),r(new B(e)).then((function(e){return e.ok?e:p.reject(e)}),(function(e){return Error,p.reject(e)}))}W.options={},W.headers={put:F,post:F,patch:F,delete:F,common:{Accept:"application/json, text/plain, */*"},custom:{}},W.CancelToken=X,W.interceptor={before:function(e){j(e.before)&&e.before.call(this,e)},method:function(e){e.emulateHTTP&&/^(PUT|PATCH|DELETE)$/i.test(e.method)&&(e.headers.set("X-HTTP-Method-Override",e.method),e.method="POST")},jsonp:function(e){"JSONP"===e.method&&(e.client=_)},json:function(e){var t=e.headers.get("Content-Type")||"";return O(e.body)&&0===t.indexOf("application/json")&&(e.body=JSON.stringify(e.body)),function(e){return e.bodyText?T(e.text(),(function(t){var n,r;if(0===(e.headers.get("Content-Type")||"").indexOf("application/json")||(r=(n=t).match(/^\s*(\[|\{)/))&&{"[":/]\s*$/,"{":/}\s*$/}[r[1]].test(n))try{e.body=JSON.parse(t)}catch(t){e.body=null}else e.body=t;return e})):e}},form:function(e){var t;t=e.body,"undefined"!=typeof FormData&&t instanceof FormData?e.headers.delete("Content-Type"):O(e.body)&&e.emulateJSON&&(e.body=$.params(e.body),e.headers.set("Content-Type","application/x-www-form-urlencoded"))},header:function(e){k(C({},W.headers.common,e.crossOrigin?{}:W.headers.custom,W.headers[b(e.method)]),(function(t,n){e.headers.has(n)||e.headers.set(n,t)}))},cors:function(e){if(y){var t=$.parse(location.href),n=$.parse(e.getUrl());n.protocol===t.protocol&&n.host===t.host||(e.crossOrigin=!0,e.emulateHTTP=!1,I||(e.client=U))}}},W.interceptors=["before","method","jsonp","json","form","header","cors"],["get","delete","head","jsonp"].forEach((function(e){W[e]=function(t,n){return this(C(n||{},{url:t,itemMethod:e}))}})),["post","put","patch"].forEach((function(e){W[e]=function(t,n,r){return this(C(r||{},{url:t,itemMethod:e,body:n}))}}));var G={showLoading:function(){},hideLoading:function(){}};var z={get:function(){return G},set:function(e){Object.assign(G,e)}},K=null,Z=0;function Q(e,t){e&&e.loading&&(1===t?1===(Z+=1)&&(K=z.get().showLoading()):setTimeout((function(){0===(Z-=1)&&z.get().hideLoading(K)}),0))}var V=function(){function e(t){o(this,e),this.httpParams=s(s(s({},{method:"GET",params:Object.create(null),loading:!1,cache:!1,isCancel:!0,useLocalCache:0,usePreResult:!1}),this.useDefaultParams()),t)}var t,n;return i(e,[{key:"useDefaultParams",value:function(){return{}}},{key:"cancelContr",value:function(e){return e.isCancel&&this.cancel(),e.cancelToken?e.cancelToken:(this.cancelSource=W.CancelToken.source(),this.cancelSource.token)}},{key:"preHttpCall",value:function(e){}},{key:"http",value:(n=r(regeneratorRuntime.mark((function t(n){var r,o,a,i,u,c,l,f=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getParams(this.httpParams,n);case 2:if(!(r=t.sent).usePreResult||!this.$preResult){t.next=5;break}return t.abrupt("return",this.$preResult);case 5:if(!(r.useLocalCache>0)){t.next=10;break}if(a=e.getLocalCache(r),i=a.localCacheName,u=a.result,o=i,!u){t.next=10;break}return t.abrupt("return",u);case 10:return c=this.cancelContr(r),Q(r,1),l=s({cancelToken:c},r),this.preHttpCall(l),this.$preResult=W(l).then((function(t){return"[object Object]"===Object.prototype.toString.call(t.body)?(r.useLocalCache&&e.setLocalCache(o,t.body),t.body.$_response=t,t.body):t})).finally((function(){Q(r,0),f.cancelSource=null})),t.abrupt("return",this.$preResult);case 16:case"end":return t.stop()}}),t,this)}))),function(e){return n.apply(this,arguments)})},{key:"cancel",value:function(){this.cancelSource&&(this.cancelSource.cancel(),this.cancelSource=null)}}],[{key:"getLocalCacheKey",value:function(e){try{var t=document.createElement("a");t.setAttribute("href",e.url);var n=s(s({},e.params),String(e.data)===e.data?{pdata:e.data}:e.data);delete n._;var r=Object.entries(n).map((function(e){var t=l(e,2),n=t[0],r=t[1];return"".concat(n,"_").concat(r)})).join("_");return"__".concat(t.pathname,"_").concat(r).replace(/[^a-z | A-Z | \d]/g,"_")}catch(e){return!1}}},{key:"getPathName",value:function(e){var t=document.createElement("a");return t.setAttribute("href",e),t.pathname.replace(/[^a-z]/g,"_")}},{key:"getParams",value:(t=r(regeneratorRuntime.mark((function t(n,r){var o,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=s(s({},n),r),t.prev=1,!o.transformParams){t.next=7;break}return t.next=5,o.transformParams(o);case 5:(a=t.sent)&&(o=a);case 7:t.next=12;break;case 9:t.prev=9,t.t0=t.catch(1);case 12:return o.method=o.method.toLocaleUpperCase(),"GET"!==o.method&&"JSONP"!==o.method||(o.cache?o.jsonpCallback=o.jsonpCallback||e.getPathName(o.url)||void 0:o.params._=+new Date),t.abrupt("return",o);case 15:case"end":return t.stop()}}),t,null,[[1,9]])}))),function(e,n){return t.apply(this,arguments)})},{key:"getLocalCache",value:function(t){var n,r=e.getLocalCacheKey(t);if(r)try{var o=JSON.parse(window.sessionStorage.getItem(r)),a=o.lastCacheTime,i=o.result;a+t.useLocalCache>=Math.round(+new Date/1e3)&&(n=i)}catch(e){}return{localCacheName:r,result:n}}},{key:"setLocalCache",value:function(e,t){setTimeout((function(){try{var n=s({},t);delete n.$_response,window.sessionStorage.setItem(e,JSON.stringify({result:n,lastCacheTime:Math.round(+new Date/1e3)}))}catch(e){}}),0)}}]),e}();e.Service=V,e.http=W,e.serviceConfig=z,Object.defineProperty(e,"__esModule",{value:!0})}));

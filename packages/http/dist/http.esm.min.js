/** @license @lljj/http (c) 2020-2020 Liu.Jun License: MIT */
function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e,t,n,r,o,a,i){try{var u=e[a](i),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,o)}function n(e){return function(){var n=this,r=arguments;return new Promise((function(o,a){var i=e.apply(n,r);function u(e){t(i,o,a,u,c,"next",e)}function c(e){t(i,o,a,u,c,"throw",e)}u(void 0)}))}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,o=!1,a=void 0;try{for(var i,u=e[Symbol.iterator]();!(r=(i=u.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){o=!0,a=e}finally{try{r||null==u.return||u.return()}finally{if(o)throw a}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return l(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function f(e,t){this.promise=e instanceof Promise?e:new Promise(e.bind(t)),this.context=t}f.all=function(e,t){return new f(Promise.all(e),t)},f.resolve=function(e,t){return new f(Promise.resolve(e),t)},f.reject=function(e,t){return new f(Promise.reject(e),t)},f.race=function(e,t){return new f(Promise.race(e),t)};var p=f.prototype;p.bind=function(e){return this.context=e,this},p.then=function(e,t){return e&&e.bind&&this.context&&(e=e.bind(this.context)),t&&t.bind&&this.context&&(t=t.bind(this.context)),new f(this.promise.then(e,t),this.context)},p.catch=function(e){return e&&e.bind&&this.context&&(e=e.bind(this.context)),new f(this.promise.catch(e),this.context)},p.finally=function(e){return this.then((function(t){return e.call(this),t}),(function(t){return e.call(this),Promise.reject(t)}))};var h={}.hasOwnProperty,d=[].slice,m="undefined"!=typeof window;function y(e){return e?e.replace(/^\s*|\s*$/g,""):""}function v(e){return e?e.toLowerCase():""}var b=Array.isArray;function g(e){return"string"==typeof e}function w(e){return"function"==typeof e}function j(t){return null!==t&&"object"===e(t)}function O(e){return j(e)&&Object.getPrototypeOf(e)===Object.prototype}function x(e,t,n){var r=f.resolve(e);return arguments.length<2?r:r.then(t,n)}function k(e,t){var n,r;if(b(e))for(n=0;n<e.length;n++)t.call(e[n],e[n],n);else if(j(e))for(r in e)h.call(e,r)&&t.call(e[r],e[r],r);return e}var T=Object.assign||function(e){var t=d.call(arguments,1);return t.forEach((function(t){C(e,t)})),e};function C(e,t,n){for(var r in t)n&&(O(t[r])||b(t[r]))?(O(t[r])&&!O(e[r])&&(e[r]={}),b(t[r])&&!b(e[r])&&(e[r]=[]),C(e[r],t[r],n)):void 0!==t[r]&&(e[r]=t[r])}function P(e,t,n){var r=function(e){var t=["+","#",".","/",";","?","&"],n=[];return{vars:n,expand:function(r){return e.replace(/\{([^{}]+)\}|([^{}]+)/g,(function(e,o,a){if(o){var i=null,u=[];if(-1!==t.indexOf(o.charAt(0))&&(i=o.charAt(0),o=o.substr(1)),o.split(/,/g).forEach((function(e){var t=/([^:*]*)(?::(\d+)|(\*))?/.exec(e);u.push.apply(u,function(e,t,n,r){var o=e[n],a=[];if(E(o)&&""!==o)if("string"==typeof o||"number"==typeof o||"boolean"==typeof o)o=o.toString(),r&&"*"!==r&&(o=o.substring(0,parseInt(r,10))),a.push(A(t,o,S(t)?n:null));else if("*"===r)Array.isArray(o)?o.filter(E).forEach((function(e){a.push(A(t,e,S(t)?n:null))})):Object.keys(o).forEach((function(e){E(o[e])&&a.push(A(t,o[e],e))}));else{var i=[];Array.isArray(o)?o.filter(E).forEach((function(e){i.push(A(t,e))})):Object.keys(o).forEach((function(e){E(o[e])&&(i.push(encodeURIComponent(e)),i.push(A(t,o[e].toString())))})),S(t)?a.push(encodeURIComponent(n)+"="+i.join(",")):0!==i.length&&a.push(i.join(","))}else";"===t?a.push(encodeURIComponent(n)):""!==o||"&"!==t&&"?"!==t?""===o&&a.push(""):a.push(encodeURIComponent(n)+"=");return a}(r,i,t[1],t[2]||t[3])),n.push(t[1])})),i&&"+"!==i){var c=",";return"?"===i?c="&":"#"!==i&&(c=i),(0!==u.length?i:"")+u.join(c)}return u.join(",")}return R(a)}))}}}(e),o=r.expand(t);return n&&n.push.apply(n,r.vars),o}function E(e){return null!=e}function S(e){return";"===e||"&"===e||"?"===e}function A(e,t,n){return t="+"===e||"#"===e?R(t):encodeURIComponent(t),n?encodeURIComponent(n)+"="+t:t}function R(e){return e.split(/(%[0-9A-Fa-f]{2})/g).map((function(e){return/%[0-9A-Fa-f]/.test(e)||(e=encodeURI(e)),e})).join("")}function L(e,t){var n,r=this||{},o=e;return g(e)&&(o={url:e,params:t}),o=function(e){var t=d.call(arguments,1);return t.forEach((function(t){C(e,t,!0)})),e}({},L.options,r.$options,o),L.transforms.forEach((function(e){g(e)&&(e=L.transform[e]),w(e)&&(n=function(e,t,n){return function(r){return e.call(n,r,t)}}(e,n,r.$vm))})),n(o)}function $(e){return new f((function(t){var n=new XDomainRequest,r=function(r){var o=r.type,a=0;"load"===o?a=200:"error"===o&&(a=500),t(e.respondWith(n.responseText,{status:a}))};e.abort=function(){return n.abort()},n.open(e.method,e.getUrl()),e.timeout&&(n.timeout=e.timeout),n.onload=r,n.onabort=r,n.onerror=r,n.ontimeout=r,n.onprogress=function(){},n.send(e.getBody())}))}L.options={url:"",root:null,params:{}},L.transform={template:function(e){var t=[],n=P(e.url,e.params,t);return t.forEach((function(t){delete e.params[t]})),n},query:function(e,t){var n=Object.keys(L.options.params),r={},o=t(e);return k(e.params,(function(e,t){-1===n.indexOf(t)&&(r[t]=e)})),(r=L.params(r))&&(o+=(-1==o.indexOf("?")?"?":"&")+r),o},root:function(e,t){var n,r,o=t(e);return g(e.root)&&!/^(https?:)?\//.test(o)&&(o="".concat((n=e.root,r="/",n&&void 0===r?n.replace(/\s+$/,""):n&&r?n.replace(new RegExp("[".concat(r,"]+$")),""):n),"/").concat(o)),o}},L.transforms=["template","query","root"],L.params=function(e){var t=[],n=encodeURIComponent;return t.add=function(e,t){w(t)&&(t=t()),null===t&&(t=""),this.push("".concat(n(e),"=").concat(n(t)))},function e(t,n,r){var o,a=b(n),i=O(n);k(n,(function(n,u){o=j(n)||b(n),r&&(u="".concat(r,"[").concat(i||o?u:"","]")),!r&&a?t.add(n.name,n.value):o?e(t,n,u):t.add(u,n)}))}(t,e),t.join("&").replace(/%20/g,"+")},L.parse=function(e){var t=document.createElement("a");return document.documentMode&&(t.href=e,e=t.href),t.href=e,{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",port:t.port,host:t.host,hostname:t.hostname,pathname:"/"===t.pathname.charAt(0)?t.pathname:"/".concat(t.pathname),search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):""}};var U=m&&"withCredentials"in new XMLHttpRequest;function I(e){return new f((function(t){var n,r,o=e.jsonp||"callback",a=e.jsonpCallback||"_jsonp".concat(Math.random().toString(36).substr(2)),i=null;n=function(n){var o=n.type,u=0;"load"===o&&null!==i?u=200:"error"===o&&(u=500),u&&window[a]&&(delete window[a],document.body.removeChild(r)),t(e.respondWith(i,{status:u}))},window[a]=function(e){i=JSON.stringify(e)},e.abort=function(){n({type:"abort"})},e.params[o]=a,e.timeout&&setTimeout(e.abort,e.timeout),(r=document.createElement("script")).src=e.getUrl(),r.type="text/javascript",r.async=!0,r.onload=n,r.onerror=n,document.body.appendChild(r)}))}function N(e){return new f((function(t){var n=new XMLHttpRequest,r=function(r){var o=e.respondWith("response"in n?n.response:n.responseText,{status:1223===n.status?204:n.status,statusText:1223===n.status?"No Content":y(n.statusText)});k(y(n.getAllResponseHeaders()).split("\n"),(function(e){o.headers.append(e.slice(0,e.indexOf(":")),e.slice(e.indexOf(":")+1))})),t(o)};e.abort=function(){return n.abort()},n.open(e.method,e.getUrl(),!0),e.timeout&&(n.timeout=e.timeout),e.responseType&&"responseType"in n&&(n.responseType=e.responseType),(e.withCredentials||e.credentials)&&(n.withCredentials=!0),e.crossOrigin||e.headers.set("X-Requested-With","XMLHttpRequest"),w(e.progress)&&"GET"===e.method&&n.addEventListener("progress",e.progress),w(e.downloadProgress)&&n.addEventListener("progress",e.downloadProgress),w(e.progress)&&/^(POST|PUT)$/i.test(e.method)&&n.upload.addEventListener("progress",e.progress),w(e.uploadProgress)&&n.upload&&n.upload.addEventListener("progress",e.uploadProgress),e.headers.forEach((function(e,t){n.setRequestHeader(t,e)})),n.onload=r,n.onabort=r,n.onerror=r,n.ontimeout=r,n.send(e.getBody())}))}function D(e){e.cancelToken&&e.cancelToken.promise.then((function(){e.abort()})),w(e.sendAfter)&&e.sendAfter.call(this,e)}function _(e){var t=(e.client||N)(e);return function(e){D.call(null,e)}(e),t}var H=function(){function e(t){var n=this;r(this,e),this.map={},k(t,(function(e,t){return n.append(t,e)}))}return a(e,[{key:"has",value:function(e){return null!==M(this.map,e)}},{key:"get",value:function(e){var t=this.map[M(this.map,e)];return t?t.join():null}},{key:"getAll",value:function(e){return this.map[M(this.map,e)]||[]}},{key:"set",value:function(e,t){this.map[function(e){if(/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return y(e)}(M(this.map,e)||e)]=[y(t)]}},{key:"append",value:function(e,t){var n=this.map[M(this.map,e)];n?n.push(y(t)):this.set(e,t)}},{key:"delete",value:function(e){delete this.map[M(this.map,e)]}},{key:"deleteAll",value:function(){this.map={}}},{key:"forEach",value:function(e,t){var n=this;k(this.map,(function(r,o){k(r,(function(r){return e.call(t,r,o,n)}))}))}}]),e}();function M(e,t){return Object.keys(e).reduce((function(e,n){return v(t)===v(n)?n:e}),null)}var J=function(){function e(t,n){var o,a=n.url,i=n.headers,u=n.status,c=n.statusText;r(this,e),this.url=a,this.ok=u>=200&&u<300,this.status=u||0,this.statusText=c||"",this.headers=new H(i),this.body=t,g(t)?this.bodyText=t:(o=t,"undefined"!=typeof Blob&&o instanceof Blob&&(this.bodyBlob=t,function(e){return 0===e.type.indexOf("text")||-1!==e.type.indexOf("json")}(t)&&(this.bodyText=function(e){return new f((function(t){var n=new FileReader;n.readAsText(e),n.onload=function(){t(n.result)}}))}(t))))}return a(e,[{key:"blob",value:function(){return x(this.bodyBlob)}},{key:"text",value:function(){return x(this.bodyText)}},{key:"json",value:function(){return x(this.text(),(function(e){return JSON.parse(e)}))}}]),e}();Object.defineProperty(J.prototype,"data",{get:function(){return this.body},set:function(e){this.body=e}});var q=function(){function e(t){var n;r(this,e),this.body=null,this.params={},T(this,t,{method:(n=t.method||"GET",n?n.toUpperCase():"")}),this.headers instanceof H||(this.headers=new H(this.headers))}return a(e,[{key:"getUrl",value:function(){return L(this)}},{key:"getBody",value:function(){return this.body}},{key:"respondWith",value:function(e,t){return new J(e,T(t||{},{url:this.getUrl()}))}}]),e}(),B=function(){function e(t){var n,o=this;if(r(this,e),"function"!=typeof t)throw new TypeError("executor must be a function.");this.promise=new Promise((function(e){n=e})),t((function(){o.reason||n()}))}return a(e,null,[{key:"source",value:function(){var t;return{token:new e((function(e){t=e})),cancel:t}}}]),e}(),X={"Content-Type":"application/json;charset=utf-8"};function F(t){var n=this||{},r=function(t){var n=[_],r=[];function o(o){for(;n.length;){var a=n.pop();if(w(a)){var i=function(){var e=void 0,n=void 0;if(j(e=a.call(t,o,(function(e){return n=e}))||n))return{v:new f((function(n,o){r.forEach((function(n){e=x(e,(function(e){return n.call(t,e)||e}),o)})),x(e,n,o)}),t)};w(e)&&r.unshift(e)}();if("object"===e(i))return i.v}else"Invalid interceptor of type ".concat(e(a),", must be a function")}}return j(t)||(t=null),o.use=function(e){n.push(e)},o}(n.$vm);return function(e){var t=d.call(arguments,1);t.forEach((function(t){for(var n in t)void 0===e[n]&&(e[n]=t[n])}))}(t||{},n.$options,F.options),F.interceptors.forEach((function(e){g(e)&&(e=F.interceptor[e]),w(e)&&r.use(e)})),r(new q(t)).then((function(e){return e.ok?e:f.reject(e)}),(function(e){return Error,f.reject(e)}))}F.options={},F.headers={put:X,post:X,patch:X,delete:X,common:{Accept:"application/json, text/plain, */*"},custom:{}},F.CancelToken=B,F.interceptor={before:function(e){w(e.before)&&e.before.call(this,e)},method:function(e){e.emulateHTTP&&/^(PUT|PATCH|DELETE)$/i.test(e.method)&&(e.headers.set("X-HTTP-Method-Override",e.method),e.method="POST")},jsonp:function(e){"JSONP"===e.method&&(e.client=I)},json:function(e){var t=e.headers.get("Content-Type")||"";return j(e.body)&&0===t.indexOf("application/json")&&(e.body=JSON.stringify(e.body)),function(e){return e.bodyText?x(e.text(),(function(t){var n,r;if(0===(e.headers.get("Content-Type")||"").indexOf("application/json")||(r=(n=t).match(/^\s*(\[|\{)/))&&{"[":/]\s*$/,"{":/}\s*$/}[r[1]].test(n))try{e.body=JSON.parse(t)}catch(t){e.body=null}else e.body=t;return e})):e}},form:function(e){var t;t=e.body,"undefined"!=typeof FormData&&t instanceof FormData?e.headers.delete("Content-Type"):j(e.body)&&e.emulateJSON&&(e.body=L.params(e.body),e.headers.set("Content-Type","application/x-www-form-urlencoded"))},header:function(e){k(T({},F.headers.common,e.crossOrigin?{}:F.headers.custom,F.headers[v(e.method)]),(function(t,n){e.headers.has(n)||e.headers.set(n,t)}))},cors:function(e){if(m){var t=L.parse(location.href),n=L.parse(e.getUrl());n.protocol===t.protocol&&n.host===t.host||(e.crossOrigin=!0,e.emulateHTTP=!1,U||(e.client=$))}}},F.interceptors=["before","method","jsonp","json","form","header","cors"],["get","delete","head","jsonp"].forEach((function(e){F[e]=function(t,n){return this(T(n||{},{url:t,itemMethod:e}))}})),["post","put","patch"].forEach((function(e){F[e]=function(t,n,r){return this(T(r||{},{url:t,itemMethod:e,body:n}))}}));var W={showLoading:function(){},hideLoading:function(){}};var G={get:function(){return W},set:function(e){Object.assign(W,e)}},z=null,K=0;function Z(e,t){e&&e.loading&&(1===t?1===(K+=1)&&(z=G.get().showLoading()):setTimeout((function(){0===(K-=1)&&G.get().hideLoading(z)}),0))}var Q=function(){function e(t){r(this,e),this.httpParams=c(c(c({},{method:"GET",params:Object.create(null),loading:!1,cache:!1,isCancel:!0,useLocalCache:0,usePreResult:!1}),this.useDefaultParams()),t)}var t,o;return a(e,[{key:"useDefaultParams",value:function(){return{}}},{key:"cancelContr",value:function(e){return e.isCancel&&this.cancel(),e.cancelToken?e.cancelToken:(this.cancelSource=F.CancelToken.source(),this.cancelSource.token)}},{key:"preHttpCall",value:function(e){}},{key:"http",value:(o=n(regeneratorRuntime.mark((function t(n){var r,o,a,i,u,s,l,f=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getParams(this.httpParams,n);case 2:if(!(r=t.sent).usePreResult||!this.$preResult){t.next=5;break}return t.abrupt("return",this.$preResult);case 5:if(!(r.useLocalCache>0)){t.next=10;break}if(a=e.getLocalCache(r),i=a.localCacheName,u=a.result,o=i,!u){t.next=10;break}return t.abrupt("return",u);case 10:return s=this.cancelContr(r),Z(r,1),l=c({cancelToken:s},r),this.preHttpCall(l),this.$preResult=F(l).then((function(t){return"[object Object]"===Object.prototype.toString.call(t.body)?(r.useLocalCache&&e.setLocalCache(o,t.body),t.body.$_response=t,t.body):t})).finally((function(){Z(r,0),f.cancelSource=null})),t.abrupt("return",this.$preResult);case 16:case"end":return t.stop()}}),t,this)}))),function(e){return o.apply(this,arguments)})},{key:"cancel",value:function(){this.cancelSource&&(this.cancelSource.cancel(),this.cancelSource=null)}}],[{key:"getLocalCacheKey",value:function(e){try{var t=document.createElement("a");t.setAttribute("href",e.url);var n=c(c({},e.params),String(e.data)===e.data?{pdata:e.data}:e.data);delete n._;var r=Object.entries(n).map((function(e){var t=s(e,2),n=t[0],r=t[1];return"".concat(n,"_").concat(r)})).join("_");return"__".concat(t.pathname,"_").concat(r).replace(/[^a-z | A-Z | \d]/g,"_")}catch(e){return!1}}},{key:"getPathName",value:function(e){var t=document.createElement("a");return t.setAttribute("href",e),t.pathname.replace(/[^a-z]/g,"_")}},{key:"getParams",value:(t=n(regeneratorRuntime.mark((function t(n,r){var o,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=c(c({},n),r),t.prev=1,!o.transformParams){t.next=7;break}return t.next=5,o.transformParams(o);case 5:(a=t.sent)&&(o=a);case 7:t.next=12;break;case 9:t.prev=9,t.t0=t.catch(1);case 12:return o.method=o.method.toLocaleUpperCase(),"GET"!==o.method&&"JSONP"!==o.method||(o.cache?o.jsonpCallback=o.jsonpCallback||e.getPathName(o.url)||void 0:o.params._=+new Date),t.abrupt("return",o);case 15:case"end":return t.stop()}}),t,null,[[1,9]])}))),function(e,n){return t.apply(this,arguments)})},{key:"getLocalCache",value:function(t){var n,r=e.getLocalCacheKey(t);if(r)try{var o=JSON.parse(window.sessionStorage.getItem(r)),a=o.lastCacheTime,i=o.result;a+t.useLocalCache>=Math.round(+new Date/1e3)&&(n=i)}catch(e){}return{localCacheName:r,result:n}}},{key:"setLocalCache",value:function(e,t){setTimeout((function(){try{var n=c({},t);delete n.$_response,window.sessionStorage.setItem(e,JSON.stringify({result:n,lastCacheTime:Math.round(+new Date/1e3)}))}catch(e){}}),0)}}]),e}();export{Q as Service,F as http,G as serviceConfig};
